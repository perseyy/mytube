{% extends "base.html" %}
{% block title %}myYouTube{% endblock %}

{% block extra_head %}
<style>
    .video-card img { width:100%; height:195px; object-fit:cover; border-radius:12px; }
    .video-title { font-weight:500; margin-top:8px; font-size:1.05rem; }
    .video-info { color:#606060; font-size:0.9rem; }
</style>
{% endblock %}

{% block content %}
<h4>Рекомендуемое</h4>
<div class="row">
    {% if videos_list %}
        {% for v in videos_list %}
        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <a href="/video/{{ v['id'] }}" class="text-decoration-none text-dark">
                <img src="/thumbnail/{{ v['filename'] }}" alt="{{ v['title'] }}" class="img-fluid">
                <div class="video-title mt-2">{{ v['title'] }}</div>
                <div class="video-info">{{ v['views'] }} просмотров • {{ v['upload_date'][:10] }}</div>
            </a>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted fs-5">Пока нет видео. Загрузите первое!</p>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    {% if open_login %}
    new bootstrap.Modal(document.getElementById('authModal')).show();
    {% endif %}

    let isLogin = true;
    document.getElementById('toggleAuth').onclick = (e) => {
        e.preventDefault();
        isLogin = !isLogin;
        document.getElementById('authTitle').textContent = isLogin ? 'Вход' : 'Регистрация';
        document.getElementById('authBtn').textContent = isLogin ? 'Войти' : 'Зарегистрироваться';
        document.getElementById('toggleAuth').textContent = isLogin ? 'Нет аккаунта? Зарегистрируйся' : 'Уже есть аккаунт? Войти';
    };

    document.getElementById('authForm').onsubmit = async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const url = isLogin ? '/login' : '/register';
        const res = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({email, password})
        });
        const data = await res.json();
        if (res.ok) {
            document.cookie = `token=${data.token}; path=/; max-age=31536000`;
            location.reload();
        } else {
            alert(data.error || 'Ошибка');
        }
    };
</script>
{% endblock %}